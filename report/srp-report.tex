\documentclass[letterpaper]{erdc}
\usepackage[all]{draftcopy}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{calc}
\usepackage{verbatim}
\usepackage{appendix}
\usepackage{multirow}
\usepackage[subnum]{cases} % force all numcases to be subnumcases
\usepackage[section]{placeins}

\usepackage{subfig}
% \usepackage{multicol}
% \setlength{\columnsep}{1cm}

\graphicspath{{graphics/}{graphics/2dbox_pngs/},{graphics/saltdome_pngs/}{graphics/elder_pngs/}{graphics/saltpool3d_pngs/}{graphics/3dbox_pngs/}{graphics/henry2d_pngs/},{graphics/goswami_clement_pngs/}}

\include{include}

\begin{document}

\frontmatter

\laboratory{Coastal and Hydraulics Laboratory}
\reportnum{ERDC/CHL TR-00-00}
\program{Military Engineering 6.2}

\title{Finite Element Methods for Variable Density Flows}

\author{S. R. Patty}
\affiliation{Department of Mathematics \\
Texas A\& M University\\
College Station, TX 77843-3368}

\author{M. W. Farthing \and C. E. Kees}
\affiliation{Coastal and Hydraulics Laboratory\\
  U.S. Army Engineer Research and Development Center\\
  3909 Halls Ferry Road\\
  Vicksburg, MS 39180-6199}

\coverart{coetr_gc_frontpage.pdf}
%
%rough bottom
%

\reporttype{Final Report}

% \distribution{Distribution authorized to U.S. Government Agencies
% only; Test and Evaluation; November 2005.  Other requests should be
% referred to U.S. Army Engineer Research and Development Center}

%\additionalinfo{Supersedes ERDC/CREL AF-01-23}

\begin{abstract}
  Add abstract
\end{abstract}

%\disclaimer{Some other disclaimer}
%\preparedfor{U.S. Army Engineer Research and Development Center\\
% 3909 Halls Ferry Road, Vicksburg, MS 39180-6199} 

\contractnum{K5318C}

%\monitoredby{U.S. Army Engineer Research and Development Center\\
%  3909 Halls Ferry Road, Vicksburg, MS 39180-6199}

%\preparedfor{}

\maketitle
\setcounter{tocdepth}{1}
\tableofcontents

\listoffiguresandtables
%\listoffigures
%
\chapter{Preface}

This report is a product of the the Reduced Order Modeling work unit of the
U.S. Army Engineer Research and Development Center (ERDC) Military Engineering
6.2 program.  The report was prepared by Mr. Spencer Patty of the Department of
Mathematics at Texas A\&M University, and by Drs. Christopher E. Kees and
Matthew W. Farthing of the Hydrologic Systems Branch.  General supervision was
provided by Dr. Hwai-Ping Cheng, Chief, Hydrologic Systems Branch, Dr. Ty
V. Wamsley, Chief, Flood and Coastal Storm Protection Division, and
Mr. Jos\'{e} E. S\'{a}nchez, Director, CHL; Ms. Pamela K. Kinnebrew was the
Technical Director.  LTC John Tucker was Acting Commander of ERDC, and
Dr. Jeffery P. Holland was the Director.

\mainmatter

\chapter{Introduction}

% why choose this method over others?  because of the variable coefficient laplacian equation which is hard to solve well
%\[ \nabla\cdot \left( \frac{1}{\rho^{k+1} \nabla \phi} \right) = \Psi,\hspace{1.5cm} \left.\partial_{\n}\phi\right|_{\partial\Omega} = 0 \]

%
%
%
%
\chapter{Variable Density Incompressible Navier-Stokes Equations}

The system of equations treated here are
\begin{equation}\label{eqn:variabledensityNavierStokes}
  \begin{cases}
    \rho_t + \nabla\cdot\left( \rho \ub\right) = 0 &\\
    \rho\left(\ub_t + \ub\cdot\nabla\ub  \right) + \nabla p - \mu\Delta \ub = \f &\\
    \nabla\cdot \ub = 0
  \end{cases}
\end{equation}
with initial and boundary conditions
\begin{equation}\label{eqn:variabledensityNavierStokesBCIC}
  \begin{cases}
    \rho(\x,0) = \rho_0(\x), & \left.\rho(\x,t)\right|_{\partial\Omega^{in}} = a(\x,t)\\
    \ub(\x,0) = \ub_0(\x), & \left.\ub(\x,t)\right|_{\partial\Omega} = 0
  \end{cases}
\end{equation}
where the inflow boundary, $\partial\Omega^{in} = \{ \x\in \partial\Omega \:|\: \ub\cdot\n <0 \}$ where $\n$ is the outward unit normal vector.  Under the restrictive assumption that $\left.\ub(\x,t)\right|_{\partial\Omega} = 0$, we have $\partial\Omega^{in}= \emptyset$.


%
%
%
\section{Preliminaries}


%
%
\subsection{Notation}
We discretize and subdivide the smooth spatial domain $\Omega\subset \R^d$ into a regular uniform triangulation $\mathcal{T}_h$ with $h>0$ denoting the mesh size.  We likewise discretize the time domain $[0,T]$ into the sequence $\{ t^0=0, t^1, t^2, \dots, t^N = T\}$  with $\tau^k:= t^k-t^{k-1}$ as the step size.  If we are using a uniform time step, then $\tau^k = \tau^{k-1} = \tau = T/N$, but we leave the option for adaptive time stepping.  We use the standard notation $f^{k} := f(t=t^k,\x)$ to refer to a function or solution $f$ at a specific timestep.  When calculating norms of solutions, we often will want a combination of time and spatial norms,  thus we introduce the notation $\left( f \right)_{\tau}:= \{ f^k \}_{k=0}^{N}$ to refer to the seqence of solutions.  For instance, give a true velocity $\ub$ and a discrete solution $\ub_h$ solved for at the time steps $\{t^0,\dots, t^{N}\}$, we may want to compute the maximum norm in time and the $X$ norm in space, say the $L^2(\Omega)^d$ or $H^1(\Omega)^d$, etc.  We denote this as
\begin{equation}
  \left\| \left( \ub - \ub_h \right)_{\tau} \right\|_{\ell^{\infty}(X)} := \max_{1\leq k \leq N} \| \ub(t^{k}) - \ub_h^{k}\|_{X}
\end{equation}
or the $\ell^2$ norm in time, denoted
\begin{equation}
  \left\| \left( \ub - \ub_h \right)_{\tau} \right\|^2_{\ell^{2}(X)} :=  \sum_{k=1}^{N} \tau^{k}\| \ub(t^{k}) - \ub_h^{k}\|^2_{X}.
\end{equation}

We denote by $X_h$ the finite element space subordinate to $\mathcal{T}_h$ for the velocity vector field.  $W_h$ will be the space for density and $M_h$ the space for pressure.  Typically we will use the Taylor-Hood space $X_h \times M_h = \left(\mathbb{P}^2\left(\mathcal{T}_h\right)\right)^d\times \mathbb{P}^1\left(\mathcal{T}_h\right)$ which satisfies the LBB inf-sup condition for velocity-pressure coupling, but any set of finite element spaces satisfying the inf-sup condition can be used.  We will also typically choose $W_h = \mathbb{P}^2\left(\mathcal{T}_h\right)$.  We likewise denote the subspace $M_h^0\subset M_h$ to be the set of functions in $M_h$ with zero mean, ie $M_h^0 := \{ f_h\in M_h \:|\: \sum_{T\in\mathcal{T}_h}\int_{T}f_h dx = 0\}$.

The algorithms described below will describe methods of finding or updating the solutions at time $t^{k+1}$
\begin{equation}(\rho^{k+1}_h, \ub^{k+1}_{h}, p^{k+1}_h) \in W_h\times\X_h\times M_h  \end{equation}
given the solutions at previous time steps.  We will use first (BDF1) and second (BDF2) order approximations of time derivatives using the Backward Difference Formula (BDF) class of approximation and refer to the various algorithms by their time order and other properties of the algorithm.

\subsection{Backward Difference Formulae}
The BDF class of derivative approximations can be described generally using the following notation: An m-th order (BDF-m) approximation of the first derivative in time  uses a linear combination of the previous m time step solutions. It is convenient to use the operator $D_{\tau,m}$ to represent the BDF-m operation of first derivative in time, mainly
\begin{equation}
 \left.\frac{\partial f}{\partial t}(t,\x)\right|_{t=t^{k+1}} =  D_{\tau,m}f^{k+1} + \mathcal{O}\left(\tau^m\right)
\end{equation}
and
\begin{equation}
  D_{\tau,m}f^{k+1} =  \frac{\beta_0}{\tau^{k+1}}f^{k+1} - \displaystyle\sum_{i=1}^{m} \frac{\beta_{i}}{\tau^{k+1}} f^{k+1-i}.
\end{equation}
When it is clear from context which order, $m$, we want to use, we will drop the $m$ from the notation and simply write $D_{\tau}f^{k+1}$ for the BDf time derivative approximation.


The first order (BDF1) approximation has $\beta_0 = \beta_1 = 1$ for uniform or adaptive time steps giving
\begin{equation}
  D_{\tau,1} f^{k+1} = \frac{f^{k+1} - f^{k}}{\tau^{k+1}}.
\end{equation}
The second order (BDF2) approximation with uniform time steps has $\beta_0 = 3/2$, $\beta_1 = 2$ and $\beta_2 = -1/2$, giving
\begin{equation}  
  D_{\tau,2} f^{k+1} = \frac{3}{2\tau}f^{k+1} - \frac{2}{\tau}f^{k} + \frac{1}{2\tau}f^{k-1}.
\end{equation}
For the second order (BDF2) adaptive time stepping, we define the ratio
\begin{equation}
  r:=\tau^{k+1}/\tau^{k}
\end{equation}
then let $\beta_0 = \frac{1+2r}{(1+r)}$, $\beta_1 = 1+r$, $\beta_2 = -\frac{r^2}{(1+r)}$ giving
\begin{equation}  
  D_{\tau,2} f^{k+1} = \frac{1+2r}{(1+r)\tau^{k+1}}f^{k+1} - \frac{1+r}{\tau^{k+1}}f^{k} + \frac{r^2}{(1+r)\tau^{k+1}}f^{k-1}.
\end{equation}
It is a simple calculation to show that this adaptive algorithm reduces to the uniform version above with uniform time steps, ie $r=1$.  There are higher order BDF formulae, but we will not use them here.

The adaptive BDF1 and BDF2 algorithms have truncation errors $\mathcal{O}\left(\tau^{k+1}\right)$ or $\mathcal{O}\left(\left(\tau^{k}+\tau^{k+1} \right)\tau^{k+1} \right)$ respectively, where as the uniform algorithms are $\mathcal{O}(\tau)$ and $\mathcal{O}(\tau^{2})$ respectively.
  

%
%
%
\section{Projection Schemes}
Before moving onto the improved models, we present the basic idea of the projection scheme as introduced by Chorin and Temam.  The key is noting the Helmholtz decomposition of square integrable functions into divergence free and curl free parts
\begin{equation}
\left[ L^2(\Omega)\right]^d = H \oplus \nabla H^1(\Omega)
\end{equation}
where
\begin{equation}
H = \{ \vb\in \left[ L^2(\Omega)\right]^d \:|\: \nabla\cdot \vb = 0, \left.\vb\cdot\n \right|_{\partial\Omega} = 0  \}.
\end{equation}

Dropping the nonlinear advection terms for ease of exposition, dividing through by density $\rho$, and using the kinematic viscosity, $\nu = \mu/\rho$, we solve for $(\ub^{k+1}, \ut^{k+1}, p^{k+1})$ as solution of 
\begin{equation}
\begin{cases}
  \ub_t - \nu\Delta\ub + \nabla p = f,& \Omega\times[0,T]\\
  \nabla\cdot \ub = 0,& \Omega\times[0,T]\\
  \left.\ub\right|_{\partial\Omega} = 0,\hspace{2mm} \left.\ub\right|_{t=0} = \ub_0,& \Omega
\end{cases}
\end{equation}
in the following manner:
\begin{description}
  \item[Step 1] Viscous Prediction:  Find $\ut^{k+1}$ that satisfies
  \begin{equation}
    \frac{1}{\tau}\left(\ut^{k+1} - \ub^{k} \right) - \nu \Delta \ut^{k+1} = f^{k+1},  \hspace{2mm} \left.\ut^{k+1}\right|_{\partial\Omega} = 0.
  \end{equation}
  
  \item[Step 2] Projection:  Find $\ub^{k+1}, \phi^{k+1}$ that satisfy
  \begin{equation}
    \begin{cases}
    \frac{1}{\tau}\left(\ub^{k+1} - \ut^{k+1} \right) + \nabla \phi^{k+1} = 0 \\
    \nabla\cdot \ub^{k+1} = 0, \hspace{2mm} \left.\ub^{k+1}\cdot\n \right|_{\partial\Omega} = 0
    \end{cases}
  \end{equation}
  
  \item[Step 3] Pressure Correction: Find $p^{k+1}$ that satisfies
  \begin{equation}
    p^{k+1} = \phi^{k+1}
  \end{equation} 
\end{description}

Notice that the second step is precisely the Helmholtz decomposition of $\ut^{k+1} = \ub^{k+1} + \nabla(\tau \phi^{k+1})$ with $\ub^{k+1}\in H$ and $\tau \phi^{k+1}\in H^1(\Omega)$.  Thus $\ub^{k+1} = P_{H}\ut^{k+1}$ is the projection of our velocity $\ut^{k+1}$ onto the divergence free subspace $H$.

Often the method of solving this system is to algebraically eliminate the velocity $\ub^{k+1}$ and then solve the system for $(\ut^{k+1},\phi^{k+1}, p^{k+1})$.  The second step becomes find $\phi^{k+1}$ such that
\begin{equation}
  -\Delta\phi^{k+1} = -\tau \nabla\cdot \ut^{k+1}, \hspace{2mm} \left.\frac{\partial \phi^{k+1}}{\partial\n}\right|_{\partial\Omega} = 0
\end{equation}
for which there are many fast Poisson solvers available. If desired, the divergence free velocity can then be backed out $\ub^{k+1} = \ut^{k+1} -\tau \nabla\phi^{k+1}$.


%
%
%
\section{Penalty-like Perturbation of Continuous Equations}
The standard approach to creating splittings has been to think about the splitting operator as a projection scheme where we have the two sequences of velocities $\{\ub^{k}\}$ and $\{\ut^{k}\}$ and the pressure increment $\{\phi^{k}\}$ that represent the Helmholtz decomposition of $L^{2}$ velocity fields into solenoidal and irrotational components
\begin{equation}
  \ut^{k} = \ub^{k} + \frac{\tau}{\rho}\nabla \phi^{k}.
\end{equation}
Thus we can view $\ub^{k}$ as the projection of our velocity field $\ut^{k}$ onto the divergence free subset of velocity fields.  This works well in the case of constant density but for variable density it is not so simple.  The literature is full of methods to try to solve the resulting non constant coefficient problem that comes from implementing this projection scheme with variable density,
\begin{equation}
  -\nabla\cdot\left(\frac{1}{\rho^{k+1}} \nabla\phi \right) = F,  \hspace{1cm} \left.\partial_n \phi\right|_{\partial\Omega} = 0.
\end{equation}  
This can be badly conditioned and rather more difficult to assemble and solve than the constant coefficient version.  In this form, it is also clear to see why uniform lower bounds on the density $\rho^{k+1}$ must be maintained for the conditioning.

We instead look at the constant density projection scheme in terms of an $\epsilon$ perturbation of the original system. Thus the formerly stated projection part becomes a penalty-like adjustment that is easily generalized to the variable density framework.

The incremental pressure correction algorithm, an improvement on the original Chorin/Temam algorithm for constant density, can be expressed solely in terms of the non-solenoidal velocity $\ut^{k}$ and pressure $p^{k}$ in the form
\begin{equation}
  \begin{cases}
    \rho\left(\frac{\ut^{k+1} - \ut^{k}}{\tau} + \ut^{k}\cdot\nabla\ut^{k+1} \right) - \mu\Delta\ut^{k+1} + \nabla\left(p^{k} + \phi^{k}  \right) = \fb^{k+1}, & \left.\ut^{k}\right|_{\partial\Omega} = 0\\
    \nabla\cdot\ut^{k+1} - \frac{\tau}{\rho}\Delta\phi^{n+1}=0, &\left.\partial_\n \phi\right|_{\partial\Omega} = 0\\
    p^{k+1} = p^{k} + \phi^{k+1}
  \end{cases}
\end{equation}
This can be seen as a discrete version of the following system   
\begin{equation}\label{eqn:discreteperturbation}
  \begin{cases}
    \rho\left(\ub_t + \ub\cdot\nabla\ub  \right) + \nabla p -\mu\Delta\ub = \fb, & \left.\ub\right|_{\partial\Omega} = 0\\
    \nabla\cdot\ub - \frac{\veps}{\rho}\Delta \phi = 0,& \left.\partial_\n \phi\right|_{\partial\Omega} = 0\\
    \veps p_t = \phi
  \end{cases}
\end{equation}
where we have replaced difference quotients with time derivatives and substituted $\veps = \tau$ for the remaining $\tau$'s and recognized $p^{k} + \phi^{k} = p^{k} + \left( p^{k} - p^{k-1} \right) = 2p^{k} - p^{k-1} \approx p^{k+1}$ as a second order extrapolation of pressure to time $t^{k+1}$.

This is a second order $\mathcal{O}(\veps^2)$ perturbation of the constant density incompressible Navier-Stokes equations.  Simpler versions of this discrete system were observed by Rannacher in \cite{rannacher1992chorin} to be nothing more than penalties on the divergence of velocity in the momentum equation in a norm resembling the $H^{-1}$ norm.  Hence the term penalty-like algorithms.  As described in \cite{guermond2009splitting}, the system~$\left(\ref{eqn:discreteperturbation}\right)$ is the starting point for the algorithms described below.






%
%
%
%
\chapter{Penalty-Like Time-Splitting Algorithms for Variable Density}
\textbf{(Note rewrite this first paragraph to be more clear.)} The key to making the jump from the constant density schemes to the below defined variable density schemes is to think of the system~$\left(\ref{eqn:discreteperturbation}\right)$ not as a projection scheme but as a penalty scheme with the penalty being applied on the divergence of velocity.  Then the pressure increment equation (the second one) can be easily modified to accommodate the variable density since instead of using the varying density in the second equation, we replace it with the constant $\veps = \chi \leq \min_{\x\in\overline{\Omega}}\rho_0(\x)$ as in equation~$\left(\ref{eqn:pressureincrementlaplacian}\right)$.  This prevents us from having to solve a variable coefficient laplacian equation at each time step and instead we can solve a constant coefficient laplacian equation for the pressure increment $\phi$.  Once we have taken care of that equation, we proceed with all the standard approaches to discretizing the other momentum equations.  In particular, we will use a semi-implicit convection term $\ub^{k}\cdot\nabla\ub^{k+1}$ to remove the nonlinearity.  The rotational part of the scheme will modify the update of pressure with an extra term consisting of a penalty for divergence of velocity as seen in equation~$\left(\ref{eqn:rotationalpressureupdate}\right)$.  

The velocity described below is not explicitly enforced to be divergence free.  The penalty terms will push it in the right direction but we cannot guarantee that it will even be numerically divergence free, meaning that 
\begin{equation}
  \dprod{\ub_h}{\nabla\wb_h} = 0, \hspace{1cm}\forall\wb_h\in\X_h
\end{equation}
may not hold.  In the proteus python package in which this will be implemented, it is possible to add some post processing to the velocity.  We can supplement the existing space after the fact with element-wise piecewise constant terms to get the Raviart-Thomas (RT) element space and project the existing solution into that space while minimizing the residual between the existing velocity and the new projected velocity under various norms.    Thus the post processed velocity will be enforced to be divergence free and close in some sense to the computed velocity.  It is also possible to add in piecewise linear terms to get the Brezzi-Douglas-Marini-1 (BDM-1) element space.  These post processed velocities can be used for the conservation of mass equation and may provide a better solution of density.

We will not hereafter distinguish between the velocity and the post processed velocity.  The theory only pertains to the computed velocity and so by default we will only be using the computed velocity.  However, in some of the examples and results we may include the use of the various post processed velocities in our algorithm.

We now introduce the algorithms and some theory on expected convergence rates.  We will include the BDF1 constant time step algorithm in Section~\ref{sec:BDF1ConstantTimeSteppingAlgorithm} as well as the modification for variable time stepping in Section~\ref{sec:BDF1VariableTimeSteppingAlgorithm}.  We will then describe the BDF2 constant time step and variable time step algorithms in Section~\ref{sec:BDF2ConstantTimeSteppingAlgorithm} and Section~\ref{sec:BDF2VariableTimeSteppingAlgorithm} respectively, along with some conjectured rates of convergence for them.  We will finish with some numerical examples and observed convergence rates in Section~\ref{sec:NumericalResults}.


%
%
\section{BDF1 Constant Time Stepping Algorithm}\label{sec:BDF1ConstantTimeSteppingAlgorithm}
We proceed in a three step update scheme.  First we update the density,  second the velocity, and third the pressure.  So given
\begin{equation}(\rho^{k}_h, \ub^{k}_{h}, p^{k}_h) \in W_h\times\X_h\times M_h  \end{equation}
we update to obtain
\begin{equation}(\rho^{k+1}_h, \ub^{k+1}_{h}, p^{k+1}_h) \in W_h\times\X_h\times M_h.\end{equation}

%
\subsection{Density Update}

We first solve the hyperbolic system with a monotone preserving scheme such as subgrid viscosity, edge stabilization or entropy viscosity using a DG or CG solver.  The equation of update is

\begin{equation}
  \frac{\rho^{k+1} - \rho^k}{\tau} + \nabla\cdot\left(\rho_h^{k+1}\ub^{k} \right) - \frac{\rho^{k+1}}{2}\nabla\cdot\ub^{k} = 0
\end{equation}
where the last term is a consistent stabilization which leads to unconditional stability of the scheme.   Our choice of hyperbolic solver scheme doesn't matter as long as it satisfies the following stability hypothesis:
\begin{equation}
  \chi \leq \displaystyle\min_{\x\in\overline{\Omega}} \rho_h^{k+1}(\x), \hspace{2cm} \displaystyle\max_{\x\in\overline{\Omega}} \rho_{h}^{k+1}(\x) \leq c_{\rho}
\end{equation}
for all $k\geq 1$.

Thus we obtain the weak solution $\rho_h^{k+1}\in W_h$ that satisfies the above requirements.  We will discuss techniques for solving the density advection equation in Section~\ref{sec:ConservationOfMassNumericalApproach}

%
\subsection{Velocity Update}
Once we have the density $\rho_h^{k+1}$ we can now solve for the velocity.  It turns out that we do not explicitly require this velocity to be divergence free, but simply penalize the divergence using the pressure rotational update.  We define our update terms
\begin{align*}
  \rho_h^{*} &= \frac{1}{2}\left( \rho_h^{k+1} + \rho_h^{k} \right)\\
  \delta p_h^{k} &= p_h^{k} - p_h^{k-1}\\
    p_h^{\#} &= p_h^{k} + \delta p_h^{k} = 2p_h^{k} - p_h^{k-1}
\end{align*}
so that $p_h^{\#}$ is a second order extrapolation of pressure to time $t^{k+1}$.  Next we  solve for $\ub_h^{k+1}\in\X_h$ that satisfies the following system for all $\vb_h\in\X_h$,
\begin{equation}\label{eqn:bdf1_momentum_constanttimestep}
  \begin{split}
\dprod{ \frac{\rho_h^{*}\ub_h^{k+1}-\rho_h^{k}\ub_h^{k} }{\tau} }{\vb_h} + \dprod{ \rho_h^{k+1}\ub_h^{k}\cdot\nabla\ub_h^{k+1} }{\vb_h}+ \mu\dprod{ \nabla \ub_h^{k+1} }{\nabla\vb_h}&\\
 + \dprod{ \frac{1}{2}\nabla\cdot\left(\rho_h^{k+1}\ub_h^{k}\right)\ub_h^{k+1} }{\vb_h} +\dprod{\nabla p_h^{\#}}{\vb_h} &= \dprod{\fb^{k+1}}{\vb_h}.
\end{split}
\end{equation}

We note that Equation~(\ref{eqn:bdf1_momentum_constanttimestep}) can be rewritten in a more recognizable format that emphasizes the consistent stabilizing term as a scaled version of conservation of mass, namely
\begin{equation}
  \begin{split}
\dprod{\rho_h^{k} \frac{\ub_h^{k+1}-\ub_h^{k} }{\tau} }{\vb_h} &+ \dprod{ \rho_h^{k+1}\ub_h^{k}\cdot\nabla\ub_h^{k+1} }{\vb_h} + \mu\dprod{ \nabla \ub_h^{k+1} }{\nabla\vb_h}+\dprod{\nabla p_h^{\#}}{\vb_h}\\
 &+ \frac{1}{2}\dprod{ \left(\frac{\rho_h^{k+1} - \rho_h^{k}}{\tau} + \nabla\cdot\left(\rho_h^{k+1}\ub_h^{k}\right)  \right )\ub_h^{k+1} }{\vb_h} = \dprod{\fb^{k+1}}{\vb_h}.
\end{split}
\end{equation}


%
\subsection{Pressure Update}
Now that we have $\rho_h^{k+1}$ and $\ub_h^{k+1}$, we solve for the pressure increment $\phi_h^{\flat}\in M_h^0$ which then allows us to solve for the pressure $p_h^{k+1}\in M_h$.  
Recalling that $\chi \leq \displaystyle\min_{\x\in\overline{\Omega}} \rho_h^{k+1}(\x)$ (note that we will often choose it to be the minimum), we let $\phi_h^{\flat}\in M^0_h$ be the weak solution of
\begin{equation}\label{eqn:pressureincrementlaplacian}
  \Delta \phi^{\flat} = \frac{\chi}{\tau}\nabla\cdot \ub^{k+1}, \hspace{1cm} \left.\partial_\n\phi^{\flat}\right|_{\partial\Omega} = 0
\end{equation}
with $\int_{\Omega} \phi^{\flat} d\x = 0$.  That is, find $\phi_h^{\flat}\in M_h^0$ (functions with mean zero) such that
\begin{equation}
  \dprod{\nabla\phi_h^{\flat}}{\nabla r_h} = \frac{\chi}{\tau}\dprod{\ub_h^{k+1}}{\nabla r_h}
\end{equation}
for all $r_h \in M_h$.  If we don't build the mean zero property into the finite element space, then equation~\ref{eqn:pressureincrementlaplacian} is an under determined system.  It is often quite difficult to obtain basis functions with mean zero, so a common approach to solving the system with this setup is to fix the value at one degree of freedom, solve the system, calculate the mean and subtract it off of the solution.  Thereby we move the solution into the zero mean subset $M_h^0\subset M_h$. 

 Once we have the pressure correction term, $\phi^{\flat}_h\in M_h^0$, we update the pressure as
\begin{equation}\label{eqn:rotationalpressureupdate}
  p^{k+1} = \phi^{\flat} + p^{k} - \mu\nabla\cdot \ub^{k+1},
\end{equation}
or in other words, we solve for $p_h^{k+1}\in M_h$ such that for all $r_h\in M_h$
\begin{equation}
  \dprod{p_h^{k+1}}{r_h} = \dprod{\phi_h^{\flat} + p_h^{k}}{r_h} + \mu\dprod{\ub_h^{k+1}}{\nabla r_h}.
\end{equation}
The last term involving the divergence of velocity makes this the \textbf{rotational form} and leaving it off is the \textbf{standard form}.  In standard form, it is simple enough to just add $p_h^{k+1}$ and $\phi_h^{\flat}$ to update $p_h^{k+1}$ instead of solving the linear system.


\subsection{Summary of BDF1 Constant Time Step Incremental Rotational Algorithm}\label{subsec:BDF1constantTimeSummary}
Given $(\rho^{k}, \ub^{k}, p^{k})\in W_h\times \X_h\times M_h$ where the spaces $\X_h\times M_h$ satisfy the standard LBB inf-sup conditions, we first solve for $\rho^{k+1}\in W_h$ such that
\begin{equation}
  \frac{\rho^{k+1} - \rho^k}{\tau} + \nabla\cdot\left(\rho_h^{k+1}\ub^{k} \right) - \frac{\rho^{k+1}}{2}\nabla\cdot\ub^{k} = 0.
\end{equation}
using a monotone preserving hyperbolic transport method.  Second, set 
\begin{equation}
  p^{\sharp} = 2p_h^{k} - p_h^{k-1}
\end{equation}
and find $\ub^{k+1}_h\in\X_h$ such that for all $\vb_h\in\X_h$,
\begin{equation}
  \begin{split}
\dprod{ \rho_h^{k}\frac{\ub_h^{k+1}-\ub_h^{k} }{\tau} }{\vb_h} + \dprod{ \rho_h^{k+1}\ub_h^{k}\cdot\nabla\ub_h^{k+1} }{\vb_h} + \mu\dprod{ \nabla \ub_h^{k+1} }{\nabla\vb_h}& \\
+ \frac{1}{2}\dprod{\left[\frac{\rho^{k+1}-\rho^{k}}{\tau} + \nabla\cdot\left(\rho_h^{k+1}\ub_h^{k}\right)\right]\ub_h^{k+1} }{\vb_h} +\dprod{\nabla p_h^{\sharp}}{\vb_h} &= \dprod{\fb^{k+1}}{\vb_h}.
\end{split}
\end{equation}
Finally we find $\phi_h^{\flat}\in M_h$ such that for all $r_h\in M_h$,
\begin{equation}
  \dprod{\nabla\phi_h^{\flat}}{\nabla r_h} = \frac{\chi}{\tau}\dprod{\ub_h^{k+1}}{\nabla r_h}
\end{equation}
where $\chi \leq \displaystyle\min_{\x\in\overline{\Omega}}\rho_0(\x)$ and update the pressure $p_h^{k+1}\in M_h$ such that for all $r_h\in M_h$
\begin{equation}
  \dprod{p_h^{k+1}}{r_h} = \dprod{\phi_h^{\flat} + p_h^{k}}{r_h} + \dprod{\mu\ub_h^{k+1}}{\nabla r_h}.
\end{equation}

Thus we have solved for $(\rho_h^{k+1}, \ub_h^{k+1}, p_h^{k+1})$ and can move on to the next time step.


\subsection{Error analysis of BDF1 Constant Time Step Incremental Rotational Algorithm}
The stability of the above algorithm is proved in \cite{guermond2009splitting} and the error analysis was carried out in \cite{guermond2011error}.  We refer the reader to those articles for details and give the main results contained in Theorem 4.2 of \cite{guermond2011error}.

We define the \textbf{Stokes projection}, $\left(\wb_h(t),q_h(t)\right) \in \X_h\times M_h$, of the solution $\left(\ub(t),p(t)\right)$ to (\ref{eqn:variabledensityNavierStokes})-(\ref{eqn:variabledensityNavierStokesBCIC}) to be the pair that solves
\begin{equation}
  \begin{cases}
    \mu\dprod{\nabla\wb_h(t)}{\nabla\vb_h} + \dprod{\nabla q_h(t)}{\vb_h} = \mu\dprod{\nabla \ub(t)}{\nabla\vb_h} - \dprod{p(t)}{\nabla\cdot\vb_h}, & \forall \vb_h \in \X_h\\
    \dprod{\wb_h(t)}{\nabla r_h} = 0, & \forall r_h\in M_h
  \end{cases}
\end{equation}

\begin{theorem}
  Assume that the true solution to (\ref{eqn:variabledensityNavierStokes}) and (\ref{eqn:variabledensityNavierStokesBCIC}) satisfies (with $l\geq 1$)
  \begin{equation}
    \ub\in W^{2,\infty}\left(\mathbf{H}_0^1(\Omega)\cap \mathbf{H}^{\ell+1}(\Omega)\right), \hspace{1cm} p\in W^{1,\infty}\left(H^{\ell}(\Omega) \right)
  \end{equation}
  Let $(\ub_h)_{\tau}$ be the solutions of velocity as described in Subsection~\ref{subsec:BDF1constantTimeSummary}.  Then if one of either
  \begin{equation}
    \|p_h^0 - q_h^0 \|_{L^2(\Omega)} \leq c h^{\frac{\ell+1}{2}}
  \end{equation}
  or
  \begin{equation}
    \|p_h^0\|_{H^1(\Omega)} \leq c \hspace{0.5cm} \mbox{and} \hspace{0.5cm} \dprod{\ub_h^0}{\nabla r_h} = 0 \hspace{0.25cm} \forall r_h\in M_h
  \end{equation}
  is satisfied, then
  \begin{equation}
    \|\left(\ub - \ub_h\right)_{\tau} \|_{\ell^{\infty}(\mathbf{L}^2(\Omega))} \leq c\left( \tau + h^{\min(\ell+1,s)} \right)
  \end{equation}
  and
  \begin{equation}
    \|\left(\ub - \ub_h\right)_{\tau} \|_{\ell^{2}(\mathbf{H}^1(\Omega))} \leq c\left( \tau + h^{\min(\ell,s)} \right)
  \end{equation}
\end{theorem}

\begin{remark}
  Here $s>0$ is a constant that deals with the coupling between velocity and our solution of density transport.  In particular it depends on the method we use to solve the mass conservation.  The details are described in Section 4.2 of \cite{guermond2011error} (using the symbol $m$ instead of $s$) where they conjecture that one can obtain $s=1$ by approximating the mass conservation with a linear first-order viscosity or first-order level set or phase field approach.  They further conjecture that $s>1$ if one uses a nonlinear stabilization technique like discontinuous Galerkin with limiters or entropy viscosity.  
\end{remark}


%
%
\section{BDF1 Variable Time Stepping Algorithm}\label{sec:BDF1VariableTimeSteppingAlgorithm}
In the case of variable time step  $\tau^{k} := t^{k}-t^{k-1}$, there are two changes for BDF1.  The choice of pressure for the momentum equations is augmented to reflect the second order extrapolation in variable time steps:
\begin{equation}
  p^{\sharp}_h := p_h^{k} + \frac{\tau^{k+1}}{\tau^{k}}\delta p_h^{k} = p_h^{k} + \frac{\tau^{k+1}}{\tau^{k}}\left( p_h^{k} - p_h^{k-1} \right).
\end{equation}
Notice that this reduces to the above case when $\tau^{k+1}=\tau^{k} = \tau$.  We also substitute the variable time step
\begin{equation}
  \tau =\tau^{k+1}.
\end{equation}
Everything else in the algorithm is kept the same as above.

\subsection{CFL Condition For Variable Step BDF1 Algorithm}\label{sec:CFLBDF1}
The convergence results have not been proved for the case of variable time stepping but it seems reasonable to expect them to still hold under a standard Courant-Friedrich-Levy (CFL) conditions augmented with a maximally allowed time step, ie
\begin{equation}
  \tau^{k+1} \leq \min \left\{c \frac{\min_{T\in\mathcal{T}_h}\left(h_{T}/p_T\right)}{\|\ub^{k}\|_{L^{\infty}(\Omega)}}, \tau^{max}\right\}, \hspace{1cm} c<1, \hspace{0.5cm}\tau^{\max} \mbox{ small enough}.
\end{equation}
Here we have used $p_T$ to mean the polynomial degree of velocity on the cell $T$ so that we are consistent with $h$ and $p$ refinement.  This time stepping scheme controls both the conservation of mass equation, since the physical velocity being used is $\ub^{k}$, and the conservation of momentum equations, since we are using the semi-implicit convection term $\ub^{k}\cdot\nabla\ub^{k+1}$ so again the physical velocity is $\ub^{k}$.  It is common in practice to choose the values $c=0.33$ or $c=0.5$.


\section{Hyperbolic Conservation of Mass Algorithms}\label{sec:ConservationOfMassNumericalApproach}



%
%
\section{BDF2 Constant Time Stepping Algorithm}\label{sec:BDF2ConstantTimeSteppingAlgorithm}

The above BDF1 schemes are proved in \cite{guermond2011error} to be first order accurate in time for the $\mathbf{L}^2(\Omega)$ and $\mathbf{H}^1(\Omega)$ norms of velocity.  However, because we have used a second order extrapolation of pressure
\begin{equation}
  p^{\sharp}_h = p_h^{k} + \frac{\tau^{k+1}}{\tau^{k}}\left( p_h^{k} - p_h^{k-1} \right) \approx p_h^{k+1} + \mathcal{O}\left(\left(\tau^{k+1}\right)^2 \right)
\end{equation}
to split the system of equations, they point out that the splitting error of the algorithm is expected to be second order.  Thus it seems logical to introduce a second order approximation to the time derivative for the velocity equations.  Likewise it might be advantageous to use an second order extrapolation of velocity 
\begin{equation}
  \ub^{*}_h = \ub_h^{k} + \frac{\tau^{k+1}}{\tau^{k}}\left( \ub_h^{k} - \ub_h^{k-1} \right)
\end{equation}
for the semi-implicit convection term, $\ub_h^{*}\cdot\nabla\ub_h^{n+1}$, again eliminating the nonlinearity and preserving the second order in time approximation.


\subsection{Density Update}
Again, the approach to solving this hyperbolic equation is not specified here but is discussed in section~\ref{sec:ConservationOfMassNumericalApproach}.  We will choose a second order hyperbolic scheme that preserves the following stability properties.  First, that there are constants $\chi, c > 0$ such that 
\begin{equation}
  \chi \leq \displaystyle\min_{\x\in\overline{\Omega}} \rho_h^{k+1}(\x),  \hspace{1.5cm} \displaystyle\sup_{\x\in\overline{\Omega}}\rho_h^{k+1}(\x) \leq c \hspace{1cm} \forall k\geq 1
\end{equation}
and secondly that when solving for $\rho_h^{k+1}\in W_h$, that there is a uniform constant $M$ such that
\begin{equation}
  \displaystyle\max_{0\leq n\leq k-1} \left \| \frac{\rho_h^{n+1} - \rho_h^{n}}{\tau}\right\|_{L^{\infty}(\Omega)} \leq M\chi.
\end{equation}

\subsection{Velocity Update}
We define
\begin{equation}
  \rho_h^{*} := \frac{3}{2}\rho_h^{k+1} - \frac{2}{3}\rho_h^{k} + \frac{1}{6}\rho_h^{k-1} = \rho_h^{k+1} + \frac{1}{6}\left(3\rho_h^{k+1} -4\rho_h^{k} + \rho_h^{k-1} \right)
\end{equation}
\begin{equation}
  p_h^{\sharp} := p_h^{k} + \frac{4}{3}\phi_h^{k} - \frac{1}{3}\phi_h^{k-1}.
\end{equation}
and the second order extrapolation of velocity
\begin{equation}
  \ub^{*}_h = 2\ub_h^{k}  - \ub_h^{k-1}.
\end{equation}
Now compute $\ub_h^{k+1}\in\X_h$ so that for all $\vb_h\in\X_h$,
\begin{equation}
  \begin{split}
    \dprod{\frac{3\rho_h^{*}\ub_h^{k+1} - 4\rho_h^{k+1}\ub_h^{k} + \rho_h^{k+1}\ub_h^{k-1}}{2\tau}}{\vb_h}  + \dprod{\mu\nabla\ub_h^{k+1}}{\nabla\vb_h} &\\
   + \dprod{\nabla p_h^{\sharp}}{\vb_h} + \dprod{\rho_h^{k+1}\ub_h^{*}\cdot\nabla\ub_h^{k+1} + \frac{1}{2}\ub_h^{k+1}\nabla\cdot\left( \rho_h^{k+1}\ub_h^{*} \right)}{\vb_h} &= \dprod{\fb^{k+1}}{\vb_h}
  \end{split}
\end{equation}
Notice that we only use $\rho_h^{k+1}$ or $\rho_h^{*}$ in the above equation.

\begin{remark}
If the terms are smooth enough, then we have
\begin{align}
  &\frac{3\rho_h^{*}\ub_h^{k+1}-4\rho_h^{k+1}\ub_h^{k} +\rho_h^{k+1}\ub_h^{k-1}}{2\tau} +\frac{1}{2}\nabla\cdot\left(\rho_h^{k+1}\ub_h^{*}\right)\ub_h^{k+1}\\
   &= \rho_h^{k+1}\left(\frac{3\ub_h^{k+1} - 4\ub_h^{k} + \ub_h^{k-1}}{2\tau}\right) + \frac{1}{2} \left( \frac{3\rho_h^{k+1} -4\rho_h^{k} + \rho_h^{k-1}}{2\tau} + \nabla\cdot\left(\rho_h^{k+1}\ub_h^{*}\right)\right)\ub_h^{k+1}\\
  &= \left.\left(\rho_h\frac{d\ub_h}{dt} \right)\right|_{t=t^{k+1}} + \left.\frac{1}{2} \left( \frac{d\rho_h}{dt} +\nabla\cdot\left(\rho_h\ub_h\right)\right)\right|_{t=t^{k+1}}\ub_h^{k+1} + \mathcal{O}(\tau^2)\\
  &=\left.\left(\rho_h\frac{d\ub_h}{dt} \right)\right|_{t=t^{k+1}} + \mathcal{O}(\tau^{2})
\end{align}
where we have used (a) the fact that $\ub_h^{*}$ is a second order in time approximation to $\ub_h^{k+1}$ and (b) the conservation of mass property to cancel the second term for the last step.
\end{remark}




%
%
\subsection{Penalty Term Update}
We compute the pressure correction $\phi_h^{k+1}\in M_h$ so that for all $r_h\in M_h$,
\begin{equation}
  \dprod{\nabla\phi_h^{k+1}}{\nabla r_h} = \frac{3\chi}{2\tau}\dprod{\ub_h^{k+1}}{\nabla r_h}.
\end{equation}

%
%
\subsection{Pressure Update}
Finally, we update the pressure with the pressure correction and the rotational term $\mu\nabla\cdot\ub_h^{k+1}$
\begin{equation}
  p_h^{k+1} = p_h^{k} + \phi_h^{k+1} - \mu\nabla\cdot\ub_h^{k+1}
\end{equation}
meaning we seek $p_h^{k+1}\in M_h$ such that for all $r_h\in M_h$
\begin{equation}
  \dprod{p_h^{k+1}}{r_h} = \dprod{p_h^{k} + \phi_h^{k+1}}{r_h} + \dprod{\mu\ub_h^{k+1}}{\nabla r_h}.
\end{equation}


\begin{remark}
Now that we have defined $\phi_h^{k}$, we can show what $p_h^{\sharp}$ represents.  In the non-rotational scheme, we have
\begin{equation}
  \phi_h^{k+1} = p_h^{k+1} - p_h^{k}
\end{equation}
so that
  \begin{align}
    p_h^{\sharp} &= p_h^{k} + \frac{4}{3}\phi_h^{k} - \frac{1}{3}\phi_h^{k-1}\\
    &= p_h^{k} + \frac{4}{3}\left(p_h^{k} - p_h^{k-1}\right) - \frac{1}{3}\left(p_h^{k-1} - p_h^{k-2}\right)\\
    &= \frac{7}{3}p_h^{k} - \frac{5}{3}p_h^{k-1}+ \frac{1}{3}p_h^{k-2} \\
    &= \frac{1}{3}\left( 3p_h^{k} - 3p_h^{k-1} + p_h^{k-2} \right) + \frac{2}{3}\left(2p_h^{k} - p_h^{k-1}  \right)\\
    &= \frac{1}{3}p_h^{k+1} + \mathcal{O}(\tau^{3}) + \frac{2}{3} p_h^{k+1} + \mathcal{O}(\tau^{2})\\
    &= p_h^{k+1} + \mathcal{O}\left(\tau^2+\tau^3\right)
  \end{align}
  since the following extrapolation schemes hold for smooth $g(t)$ with constant time step $\tau>0$, where $g^{k} := g\left(t^{k}\right)$, and $t^k = t^0+k\tau$:
  \begin{equation}
    g^{k+1} = 3g^k - 3g^{k-1}+g^{k-2} + \mathcal{O}(\tau^3) \mbox{ and } g^{k+1}=2g^{k} - g^{k-1}+\mathcal{O}(\tau^2).
  \end{equation}
  
  When the rotational scheme is used, there is an extra set of terms, which can be expanded in Taylor series in time around $t=t^{k+1}$
  \begin{align}
    -\frac{4}{3}\mu\nabla\cdot\ub_h^{k} + \frac{1}{3}\mu\nabla\cdot\ub_h^{k-1} &= \mu\nabla\cdot\left( -\frac{4}{3}\ub_h^{k} + \frac{1}{3}\ub_h^{k-1} \right)\\
    &= \mu\nabla\cdot\left( \ub^{k+1} + \frac{2}{3}\tau\ub_t^{k+1} + \mathcal{O}(\tau^{3}) \right)\\
    &= \mu\nabla\cdot\ub^{k+1} + \frac{2}{3}\tau\mu\nabla\cdot\ub_t^{k+1} + \mathcal{O}(\tau^{3})
  \end{align}
  which can be seen as a penalty term on the divergence of velocity at time $t^{k+1}$.  

\end{remark}


%
%
%
\section{General BDF1 and BDF2 Algorithm with Variable Time Steps}\label{sec:generalalgorithm}




\subsection{Updated CFL Condition for General Algorithm}
We modify the CFL condition as described in Section~\ref{sec:CFLBDF1} to use the $\ub_h^{*}$ velocity as defined in the general algorithm in Section~\ref{sec:generalalgorithm}:
\begin{equation}
  \tau^{k+1} \leq \min \left\{c \frac{\min_{T\in\mathcal{T}_h}\left(h_{T}/p_T\right)}{\|\ub_h^{*}\|_{L^{\infty}(\Omega)}}, \tau^{max}\right\}, \hspace{1cm} c<1, \hspace{0.5cm}\tau^{\max} << 1.
\end{equation}
since that is the velocity that we transport with in the density and velocity updates Equations~(\ref{eqn:generaldensity}) and (\ref{eqn:generalvelocity}).


%
%  
\subsection{General Variable Time Step BDF1-BDF2 algorithm}\label{sec:generalalgorithmdescription}

\begin{enumerate}
\item Define
\begin{equation}
  \ub_h^{*} = \begin{cases}
                \ub_h^{k}, & \mbox{BDF1} \\
                \ub_h^{k} + \frac{\tau^{k+1}}{\tau^k}\left( \ub_h^{k} - \ub_h^{k-1}\right), & \mbox{BDF2} 
               \end{cases}
 \end{equation}
then solve for density $\rho_h^{k+1}\in W_h$ that satisfies
\begin{equation}\label{eqn:generaldensity}
D_{\tau}\left(\rho_h^{k+1}\right) + \nabla\cdot\left( \rho_h^{k+1}\ub_h^{*} \right) = 0
\end{equation}
using any monotone hyperbolic scheme of appropriate order. 

\item Define
\begin{align}
  \rho_h^{\sharp} &= \begin{cases}
                       \rho_h^{k}, & \mbox{BDF1} \\
                       \rho_h^{k+1}, & \mbox{BDF2} 
                      \end{cases}\\
  p_h^{*,k+1} &= \begin{cases}
                p_h^{k}, & \mbox{BDF1}\\
                p_h^{k} + \frac{\tau^{k}}{\tau^{k-1}}\left( p_h^k - p_h^{k-1} \right), & \mbox{BDF2}
                \end{cases}\\
  p_h^{\sharp} &= \begin{cases}
                  p_h^{*,k+1} + \phi^{k}, & \mbox{BDF1}\\ 
                  p_h^{*,k+1} + \frac{\beta_1}{\beta_0}\phi^{k} + \frac{\beta_2}{\beta_0}\phi_h^{k-1}, & \mbox{BDF2} 
                 \end{cases}
\end{align}
and solve for $\ub_h^{k+1}\in\X_h$ that satisfies for all $\vb_h\in\X_h$
\begin{equation}\label{eqn:generalvelocity}
  \begin{split}
    \dprod{\rho_h^{\sharp}D_{\tau}\left(\ub_h^{k+1}\right)}{\vb_h}  + \dprod{\rho_h^{k+1}\ub_h^{*}\cdot\nabla\ub_h^{k+1}}{\vb_h} +\dprod{\nabla p_h^{\sharp}}{\vb_h} &\\
     + \dprod{\mu\nabla\ub_h^{k+1}}{\nabla\vb_h}  + \dprod{\frac{1}{2}\left[ D_{\tau}\left(\rho_h^{k+1}\right) + \nabla\cdot\left( \rho_h^{k+1}\ub_h^{*} \right)\right] \ub_h^{k+1}}{\vb_h} &= \dprod{\fb^{k+1}}{\vb_h}
  \end{split}
\end{equation}
where the last term on the left hand side is a stability term.  

\item Set $\chi = \min \rho_h^{k+1}$ and solve for $\phi_h^{k+1}\in M_h$ such that for all $r_h\in M_h$,
\begin{equation}
 \dprod{\nabla \phi_h^{k+1}}{\nabla r_h} = \beta_0 \chi \dprod{\ub_h^{k+1}}{\nabla r_h}
\end{equation}
with $\int_{\Omega}\phi_h^{k+1}d\x = 0$.  Notice that we have incorporated the natural boundary condition $\left.\nabla\phi_h^{k+1}\cdot\n\right|_{\partial\Omega} = 0 $ already in this formulation.  

\item Solve for $p_h^{k+1}\in M_h$ such that for all $r_h\in M_h$
\begin{equation}
  \dprod{p_h^{k+1}}{r_h} = \dprod{p_h^{*,k+1} + \phi_h^{k+1}}{r_h} + \dprod{\mu \ub_h^{k+1}}{\nabla r_h}.
\end{equation}
\end{enumerate}


\newpage
%
%
%
\section{Numerical Results}\label{sec:NumericalResults}

% \begin{table}[h!]
%   \begin{center}
%     \caption{Velocity Error Max Norm in Time BDF1}
%     \begin{tabular}{c|l|c|l|c}
%       numTS &  $\displaystyle\max_{k} \left\|\ub^{k}_{h}\right\|_{L^2}$ &  Rate  &  $\displaystyle\max_{k} \left\|\ub^{k}_{h}\right\|_{H^1}$ &  Rate\\
%       \hline
%       00050 &  8.621e-03 &  -  &  3.676e-02 &  -\\
%       00100 &  3.688e-03 &  1.23  &  1.579e-02 &  1.22\\
%       00200 &  1.682e-03 &  1.13  &  7.210e-03 &  1.13\\
%       00400 &  8.088e-04 &  1.06  &  3.464e-03 &  1.06\\
%       00816 &  3.911e-04 &  1.02  &  1.674e-03 &  1.02
%     \end{tabular}
%   \end{center}
% \end{table}
%
% \begin{table}[h!]
%   \begin{center}
%     \caption{Velocity Error $\ell^2$ Norm in Time BDF1}
%     \begin{tabular}{c|l|c|l|c}
%       numTS &  $\left\|\left(\ub_h\right)_{\tau}\right\|_{\ell^2(L^2)}$  &  Rate  &  $\left\|\left(\ub_h\right)_{\tau}\right\|_{\ell^2(H^1)}$  &  Rate\\
%       \hline
%       00050 &  1.321e-02 &  -  &  5.723e-02 &  -\\
%       00100 &  5.741e-03 &  1.20  &  2.512e-02 &  1.19\\
%       00200 &  2.638e-03 &  1.12  &  1.160e-02 &  1.11\\
%       00400 &  1.273e-03 &  1.05  &  5.600e-03 &  1.05\\
%       00816 &  6.162e-04 &  1.02  &  2.710e-03 &  1.02
%     \end{tabular}
%   \end{center}
% \end{table}
%
% \begin{table}[h!]
%   \begin{center}
%     \caption{Density Error Norms BDF1}
%     \begin{tabular}{l|l|c|l|c}
%       numTS  & $\displaystyle\max_{k} \left\|\rho^{k}_{h}\right\|_{L^2}$ &  Rate  &  $\left\|\left(\rho_h\right)_{\tau}\right\|_{\ell^2(L^2)}$  &  Rate\\
%       \hline
%       00050  & 1.195e-01 &  -  &  1.929e-01 &  -\\
%       00100  & 6.095e-02 &  0.97  &  9.778e-02 &  0.98\\
%       00200  & 3.079e-02 &  0.99  &  4.921e-02 &  0.99\\
%       00400  & 1.547e-02 &  0.99  &  2.469e-02 &  1.00\\
%       00816  & 7.601e-03 &  1.00  &  1.212e-02 &  1.00
%     \end{tabular}
%   \end{center}
% \end{table}
%
% \begin{table}[h!]
%   \begin{center}
%     \caption{Pressure Error Norms BDF1}
%     \begin{tabular}{l|l|c|l|c}
%       numTS &  $\displaystyle\max_{k} \left\|p^{k}_{h}\right\|_{L^2}$ &  Rate  &  $\left\|\left(p_h\right)_{\tau}\right\|_{\ell^2(L^2)}$  &  Rate\\
%       \hline
%       00050 &  8.914e-02  &  -  & 1.262e-01 &  -\\
%       00100 &  9.600e-02  & -0.11  & 1.285e-01 & -0.00\\
%       00200 &  1.071e-01  & -0.16  & 1.578e-01 & -0.30\\
%       00400 &  1.184e-01  & -0.14  & 1.845e-01 & -0.23\\
%       00816 &  1.280e-01  & -0.11  & 2.040e-01 & -0.14
%     \end{tabular}
%   \end{center}
% \end{table}



% T=5 BDF1 Rotational

% \begin{table}[h!]
%   \begin{center}
%     \caption{Density Error $L^2(\Omega)$ BDF1}
%     \begin{tabular}{c|c|l|c|l|c}
%       dt & numTS  & $\displaystyle\max_{k} \left\|\rho^{k}_{h}\right\|_{L^2}$ &  Rate  &  $\left\|\left(\rho_h\right)_{\tau}\right\|_{\ell^2(L^2)}$  &  Rate\\
%       \hline
%       0.1     & 00050 & 1.191e-01 &   -  & 1.954e-01 &   - \\
%       0.05    & 00100 & 6.049e-02 & 0.98 & 9.809e-02 & 0.99\\
%       0.025   & 00200 & 3.058e-02 & 0.98 & 4.917e-02 & 1.00\\
%       0.0125  & 00400 & 1.540e-02 & 0.99 & 2.464e-02 & 1.00\\
%       0.00625 & 00800 & 7.732e-03 & 0.99 & 1.235e-02 & 1.00
%     \end{tabular}
%   \end{center}
% \end{table}
%
% \begin{table}[h!]
%   \begin{center}
%     \caption{Velocity Error $L^2(\Omega)^d$ BDF1}
%     \begin{tabular}{c|c|l|c|l|c}
%       dt & numTS &  $\displaystyle\max_{k} \left\|\ub^{k}_{h}\right\|_{L^2}$ &  Rate  & $\left\|\left(\ub_h\right)_{\tau}\right\|_{\ell^2(L^2)}$  &  Rate \\
%       \hline
%       0.1     & 00050 & 9.122e-03 &   -  & 1.390e-02 &   - \\
%       0.05    & 00100 & 3.844e-03 & 1.25 & 5.974e-03 & 1.22\\
%       0.025   & 00200 & 1.719e-03 & 1.16 & 2.695e-03 & 1.15\\
%       0.0125  & 00400 & 8.156e-04 & 1.08 & 1.283e-03 & 1.07\\
%       0.00625 & 00800 & 4.002e-04 & 1.03 & 6.305e-04 & 1.03
%     \end{tabular}
%   \end{center}
% \end{table}
%
%
% \begin{table}[h!]
%   \begin{center}
%     \caption{Velocity Error $H^1(\Omega)^d$ BDF1}
%     \begin{tabular}{c|c|l|c|l|c}
%       dt & numTS &  $\displaystyle\max_{k} \left\|\ub^{k}_{h}\right\|_{H^1}$ &  Rate   &  $\left\|\left(\ub_h\right)_{\tau}\right\|_{\ell^2(H^1)}$  &  Rate\\
%       \hline
%       0.1     & 00050 & 3.885e-02 &  -   & 6.001e-02 &  -  \\
%       0.05    & 00100 & 1.646e-02 & 1.24 & 2.608e-02 & 1.20\\
%       0.025   & 00200 & 7.370e-03 & 1.16 & 1.184e-02 & 1.14\\
%       0.0125  & 00400 & 3.495e-03 & 1.08 & 5.645e-03 & 1.07\\
%       0.00625 & 00800 & 1.713e-03 & 1.03 & 2.774e-03 & 1.03
%     \end{tabular}
%   \end{center}
% \end{table}
%
% \begin{table}[h!]
%   \begin{center}
%     \caption{Pressure Error $L^2(\Omega)$ BDF1}
%     \begin{tabular}{c|c|l|c|l|c}
%       dt & numTS &  $\displaystyle\max_{k} \left\|p^{k}_{h}\right\|_{L^2}$ &  Rate  &  $\left\|\left(p_h\right)_{\tau}\right\|_{\ell^2(L^2)}$  &  Rate\\
%       \hline
%       0.1     & 00050 & 4.466e-02 &   -  & 6.918e-02 &   - \\
%       0.05    & 00100 & 2.124e-02 & 1.07 & 3.256e-02 & 1.09\\
%       0.025   & 00200 & 1.033e-02 & 1.04 & 1.575e-02 & 1.05\\
%       0.0125  & 00400 & 5.110e-03 & 1.02 & 7.766e-03 & 1.02\\
%       0.00625 & 00800 & 2.547e-03 & 1.00 & 3.865e-03 & 1.01
%     \end{tabular}
%   \end{center}
% \end{table}


% T=10 BDF1 Rotational

\subsection{BDF1 Algorithm Results}
\begin{table}[h!]
  \parbox{.45\linewidth}{
  \tiny
  \centering
    \caption{Density Error $(\rho - \rho_h)_{\tau}$ BDF1 Rotational, $T=10$}
    \begin{tabular}{c|l|c|l|c}
      $\tau$  & $\ell^{\infty}\left(L^2(\Omega)\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)\right)$  &  Rate\\
      \hline
      1.000e-01 & 2.140e-01 &   -  & 4.033e-01 &   - \\
      5.000e-02 & 1.142e-01 & 0.91 & 2.102e-01 & 0.94\\
      2.500e-02 & 5.906e-02 & 0.95 & 1.073e-01 & 0.97\\
      1.250e-02 & 3.003e-02 & 0.98 & 5.421e-02 & 0.99\\
      6.250e-03 & 1.514e-02 & 0.99 & 2.724e-02 & 0.99
    \end{tabular}
    }
    \hfill
    \parbox{.45\linewidth}{
      \tiny
      \centering
        \caption{Pressure Error $(p - p_h)_{\tau}$ BDF1 Rotational, $T=10$}
        \begin{tabular}{c|l|c|l|c}
          $\tau$ &  $\ell^{\infty}\left(L^2(\Omega)\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)\right)$  &  Rate\\
          \hline
          1.000e-01 & 5.429e-02 &   -  & 1.138e-01 &   - \\
          5.000e-02 & 2.676e-02 & 1.02 & 5.478e-02 & 1.05\\
          2.500e-02 & 1.329e-02 & 1.01 & 2.687e-02 & 1.03\\
          1.250e-02 & 6.644e-03 & 1.00 & 1.335e-02 & 1.01\\
          6.250e-03 & 3.329e-03 & 1.00 & 6.669e-03 & 1.00
        \end{tabular}
    }
\end{table}

\begin{table}[h!]
  \parbox{.45\linewidth}{
  \tiny
  \centering
    \caption{Velocity Error $(\ub - \ub_h)_{\tau}$ BDF1 Rotational, $T=10$}
    \begin{tabular}{c|l|c|l|c}
      $\tau$ &  $\ell^{\infty}\left(L^2(\Omega)^d\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)^d\right)$  &  Rate\\
      \hline
      1.000e-01 & 9.162e-03 &   -  & 9.039e-02 &   - \\
      5.000e-02 & 3.866e-03 & 1.24 & 3.948e-02 & 1.20\\
      2.500e-02 & 1.738e-03 & 1.15 & 1.801e-02 & 1.13\\
      1.250e-02 & 8.286e-04 & 1.07 & 8.615e-03 & 1.06\\
      6.250e-03 & 4.075e-04 & 1.02 & 4.238e-03 & 1.02
    \end{tabular}
    }
    \hfill
    \parbox{.45\linewidth}{
    \tiny
    \centering
      \caption{Velocity Error $(\ub - \ub_h)_{\tau}$ BDF1 Rotational, $T=10$}
      \begin{tabular}{c|l|c|l|c}
        $\tau$ &  $\ell^{\infty}\left(H^1(\Omega)^d\right)$ &  Rate  &  $\ell^2\left(H^1(\Omega)^d\right)$  &  Rate\\
        \hline
        1.000e-01 & 2.085e-02 &   -  & 3.926e-02 &   - \\
        5.000e-02 & 8.974e-03 & 1.22 & 1.679e-02 & 1.22\\
        2.500e-02 & 4.060e-03 & 1.14 & 7.649e-03 & 1.13\\
        1.250e-02 & 1.937e-03 & 1.07 & 3.685e-03 & 1.05\\
        6.250e-03 & 9.522e-04 & 1.02 & 1.822e-03 & 1.02
      \end{tabular}
    }
\end{table}

\subsection{BDF2 Algorithm Results}

% \begin{table}[h!]
%   \tiny
%   \centering
%     \caption{Velocity Error $(\ub - \ub_h)_{\tau}$ BDF1 Rotational, $T=10$}
%     \begin{tabular}{c|l|c|l|c}
%       $\tau$ &  $\ell^{\infty}\left(H^1(\Omega)^d\right)$ &  Rate  &  $\ell^2\left(H^1(\Omega)^d\right)$  &  Rate\\
%       \hline
%       1.000e-01 & 2.085e-02 &   -  & 3.926e-02 &   - \\
%       5.000e-02 & 8.974e-03 & 1.22 & 1.679e-02 & 1.22\\
%       2.500e-02 & 4.060e-03 & 1.14 & 7.649e-03 & 1.13\\
%       1.250e-02 & 1.937e-03 & 1.07 & 3.685e-03 & 1.05\\
%       6.250e-03 & 9.522e-04 & 1.02 & 1.822e-03 & 1.02
%     \end{tabular}
% \end{table}

% \begin{table}[h!]
%   \tiny
%   \centering
%     \caption{Pressure Error $(p - p_h)_{\tau}$ BDF1 Rotational, $T=10$}
%     \begin{tabular}{c|l|c|l|c}
%       $\tau$ &  $\ell^{\infty}\left(L^2(\Omega)\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)\right)$  &  Rate\\
%       \hline
%       1.000e-01 & 5.429e-02 &   -  & 1.138e-01 &   - \\
%       5.000e-02 & 2.676e-02 & 1.02 & 5.478e-02 & 1.05\\
%       2.500e-02 & 1.329e-02 & 1.01 & 2.687e-02 & 1.03\\
%       1.250e-02 & 6.644e-03 & 1.00 & 1.335e-02 & 1.01\\
%       6.250e-03 & 3.329e-03 & 1.00 & 6.669e-03 & 1.00
%     \end{tabular}
% \end{table}




% \newpage

\begin{table}[h!]
  \parbox{.45\linewidth}{
  \tiny
  \centering
    \caption{Density Error $(\rho - \rho_h)_{\tau}$ BDF2 Rotational Model, $T=10$}
    \begin{tabular}{c|l|c|l|c}
      $\tau$  & $\ell^{\infty}\left(L^2(\Omega)\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)\right)$  &  Rate\\
      \hline
      5.000e-02 & 4.940e-03 &  -   & 1.090e-02 &  -  \\
      2.500e-02 & 1.389e-03 & 1.83 & 3.112e-03 & 1.81\\
      1.250e-02 & 3.933e-04 & 1.82 & 8.899e-04 & 1.81\\
      6.250e-03 & 1.147e-04 & 1.78 & 2.613e-04 & 1.77
    \end{tabular}
    }
    \hfill
    \parbox{.45\linewidth}{
    \tiny
    \centering
      \caption{Density Error $(\rho - \rho_h)_{\tau}$ BDF2 Standard Model, $T=10$}
      \begin{tabular}{c|l|c|l|c}
        $\tau$  & $\ell^{\infty}\left(L^2(\Omega)\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)\right)$  &  Rate\\
        \hline
        5.000e-02 & 2.769e-02 &  -   & 5.512e-02 &  -  \\
        2.500e-02 & 8.435e-03 & 1.71 & 1.710e-02 & 1.69\\
        1.250e-02 & 2.581e-03 & 1.71 & 5.361e-03 & 1.67\\
        6.250e-03 & 6.056e-04 & 2.09 & 1.295e-03 & 2.05
      \end{tabular}
    }
\end{table}

\begin{table}[h!]
  \parbox{.45\linewidth}{
  \tiny
  \centering
    \caption{Velocity Error $(\ub - \ub_h)_{\tau}$ BDF2 Rotational Model, $T=10$}
    \begin{tabular}{c|l|c|l|c}
      $\tau$ &  $\ell^{\infty}\left(L^2(\Omega)^d\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)^d\right)$  &  Rate\\
      \hline
      5.000e-02 & 1.959e-03 &  -   & 1.607e-02 &  -  \\
      2.500e-02 & 5.978e-04 & 1.71 & 4.842e-03 & 1.73\\
      1.250e-02 & 1.668e-04 & 1.84 & 1.387e-03 & 1.80\\
      6.250e-03 & 4.430e-05 & 1.91 & 3.934e-04 & 1.82
    \end{tabular}
    }
    \hfill
    \parbox{.45\linewidth}{
    \tiny
    \centering
      \caption{Velocity Error $(\ub - \ub_h)_{\tau}$ BDF2 Standard Model, $T=10$}
      \begin{tabular}{c|l|c|l|c}
        $\tau$ &  $\ell^{\infty}\left(L^2(\Omega)^d\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)^d\right)$  &  Rate\\
        \hline
        5.000e-02 & 2.547e-03 &  -   & 3.041e-02 &  -  \\
        2.500e-02 & 6.968e-04 & 1.87 & 9.607e-03 & 1.66\\
        1.250e-02 & 1.819e-04 & 1.94 & 3.221e-03 & 1.58\\
        6.250e-03 & 4.681e-05 & 1.96 & 1.067e-03 & 1.59
      \end{tabular}
    }
\end{table}


\begin{table}[h!]
  \parbox{.45\linewidth}{
  \tiny
  \centering
    \caption{Velocity Error $(\ub - \ub_h)_{\tau}$ BDF2 Rotational Model, $T=10$}
    \begin{tabular}{c|l|c|l|c}
      $\tau$ &  $\ell^{\infty}\left(H^1(\Omega)^d\right)$ &  Rate  &  $\ell^2\left(H^1(\Omega)^d\right)$  &  Rate\\
      \hline
      5.000e-02 & 3.682e-03 &  -   & 8.568e-03 &  -  \\
      2.500e-02 & 1.082e-03 & 1.77 & 2.729e-03 & 1.65\\
      1.250e-02 & 2.985e-04 & 1.86 & 8.164e-04 & 1.74\\
      6.250e-03 & 7.926e-05 & 1.91 & 2.381e-04 & 1.78
    \end{tabular}
    }
    \hfill
    \parbox{.45\linewidth}{
    \tiny
    \centering
      \caption{Velocity Error $(\ub - \ub_h)_{\tau}$ BDF2 Standard Model, $T=10$}
      \begin{tabular}{c|l|c|l|c}
        $\tau$ &  $\ell^{\infty}\left(H^1(\Omega)^d\right)$ &  Rate  &  $\ell^2\left(H^1(\Omega)^d\right)$  &  Rate\\
        \hline
        5.000e-02 & 5.437e-03 &  -   & 1.307e-02 &  -  \\
        2.500e-02 & 1.389e-03 & 1.97 & 4.076e-03 & 1.68\\
        1.250e-02 & 3.508e-04 & 1.99 & 1.373e-03 & 1.57\\
        6.250e-03 & 8.828e-05 & 1.99 & 4.666e-04 & 1.56
      \end{tabular}\tiny
    }
\end{table}

\begin{table}[h!]
  \parbox{.45\linewidth}{
  \tiny
  \centering
    \caption{Pressure Error $(p - p_h)_{\tau}$ BDF2 Rotational Model, $T=10$}
    \begin{tabular}{c|l|c|l|c}
      $\tau$ &  $\ell^{\infty}\left(L^2(\Omega)\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)\right)$  &  Rate\\
      \hline
      5.000e-02 & 1.256e-02 &  -   & 1.180e-02 &  -  \\
      2.500e-02 & 7.181e-03 & 0.81 & 3.656e-03 & 1.69\\
      1.250e-02 & 4.219e-03 & 0.77 & 1.109e-03 & 1.72\\
      6.250e-03 & 2.292e-03 & 0.88 & 3.603e-04 & 1.62
    \end{tabular}
    }
    \hfill
    \parbox{.45\linewidth}{
    \tiny
    \centering
      \caption{Pressure Error $(p - p_h)_{\tau}$ BDF2 Standard Model, $T=10$}
      \begin{tabular}{c|l|c|l|c}
        $\tau$ &  $\ell^{\infty}\left(L^2(\Omega)\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)\right)$  &  Rate\\
        \hline
        5.000e-02 & 1.904e-02 &  -   & 3.781e-02 &  -  \\
        2.500e-02 & 7.863e-03 & 1.28 & 1.132e-02 & 1.74\\
        1.250e-02 & 4.303e-03 & 0.87 & 3.598e-03 & 1.65\\
        6.250e-03 & 2.324e-03 & 0.89 & 1.162e-03 & 1.63
      \end{tabular}
    }
\end{table}

% % BDF2 T=10 Standard
%
% \begin{table}[h!]
%   \small
%   \centering
%     \caption{Density Error $(\rho - \rho_h)_{\tau}$ BDF2 Standard Model, $T=10$}
%     \begin{tabular}{c|l|c|l|c}
%       $\tau$  & $\ell^{\infty}\left(L^2(\Omega)\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)\right)$  &  Rate\\
%       \hline
%       5.000e-02 & 2.769e-02 &  -   & 5.512e-02 &  -  \\
%       2.500e-02 & 8.435e-03 & 1.71 & 1.710e-02 & 1.69\\
%       1.250e-02 & 2.581e-03 & 1.71 & 5.361e-03 & 1.67\\
%       6.250e-03 & 6.056e-04 & 2.09 & 1.295e-03 & 2.05
%     \end{tabular}
% \end{table}
%
% \begin{table}[h!]
%   \small
%   \centering
%     \caption{Velocity Error $(\ub - \ub_h)_{\tau}$ BDF2 Standard Model, $T=10$}
%     \begin{tabular}{c|l|c|l|c}
%       $\tau$ &  $\ell^{\infty}\left(L^2(\Omega)^d\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)^d\right)$  &  Rate\\
%       \hline
%       5.000e-02 & 2.547e-03 &  -   & 3.041e-02 &  -  \\
%       2.500e-02 & 6.968e-04 & 1.87 & 9.607e-03 & 1.66\\
%       1.250e-02 & 1.819e-04 & 1.94 & 3.221e-03 & 1.58\\
%       6.250e-03 & 4.681e-05 & 1.96 & 1.067e-03 & 1.59
%     \end{tabular}
% \end{table}
%
%
% \begin{table}[h!]
%   \small
%   \centering
%     \caption{Velocity Error $(\ub - \ub_h)_{\tau}$ BDF2 Standard Model, $T=10$}
%     \begin{tabular}{c|l|c|l|c}
%       $\tau$ &  $\ell^{\infty}\left(H^1(\Omega)^d\right)$ &  Rate  &  $\ell^2\left(H^1(\Omega)^d\right)$  &  Rate\\
%       \hline
%       5.000e-02 & 5.437e-03 &  -   & 1.307e-02 &  -  \\
%       2.500e-02 & 1.389e-03 & 1.97 & 4.076e-03 & 1.68\\
%       1.250e-02 & 3.508e-04 & 1.99 & 1.373e-03 & 1.57\\
%       6.250e-03 & 8.828e-05 & 1.99 & 4.666e-04 & 1.56
%     \end{tabular}
% \end{table}
%
% \begin{table}[h!]
%   \small
%   \centering
%     \caption{Pressure Error $(p - p_h)_{\tau}$ BDF2 Standard Model, $T=10$}
%     \begin{tabular}{c|l|c|l|c}
%       $\tau$ &  $\ell^{\infty}\left(L^2(\Omega)\right)$ &  Rate  &  $\ell^2\left(L^2(\Omega)\right)$  &  Rate\\
%       \hline
%       5.000e-02 & 1.904e-02 &  -   & 3.781e-02 &  -  \\
%       2.500e-02 & 7.863e-03 & 1.28 & 1.132e-02 & 1.74\\
%       1.250e-02 & 4.303e-03 & 0.87 & 3.598e-03 & 1.65\\
%       6.250e-03 & 2.324e-03 & 0.89 & 1.162e-03 & 1.63
%     \end{tabular}
% \end{table}






\section{Constant Density Incompressible Navier Stokes in Standard Form Convergence Theorems}

The numerical solution $(\ub^k, \ut^k,p^k)$ of the constant density incompressible Navier-Stokes algorithm in standard form using BDF2 time derivative has the following error estimates hold, Theorems (3.1)-(3.5) of \cite{guermond1997resultat}.

\begin{theorem}\label{thm:guermondthm3.1}
If $\ub(t,x)\in W^{1,\infty}\left(0,T;\; H_0^1(\Omega)^d \cap H^{\ell+1}(\Omega)^d  \right) \cap H^2\left(0,T;\; H^1(\Omega)^d\right)$ and $p\in W^{1,\infty}\left(0,T;\; H^{\ell}(\Omega) \right)\cap H^2\left(0,T;\; L^2(\Omega)\right)$, then
  \begin{equation}
    \left\| \left(\ub - \ub_h \right)_{\tau} \right\|_{\ell^{\infty}\left(L^2(\Omega)^d\right)} + \left\| \left(\ub - \ut_h \right)_{\tau} \right\|_{\ell^{\infty}\left(L^2(\Omega)^d\right)} \lesssim \tau + h^{\ell+1}
  \end{equation}
\end{theorem}

\begin{theorem}\label{thm:guermondthm3.2}
If $\ub(t,x)\in W^{2,\infty}\left(0,T;\; H_0^1(\Omega)^d \cap H^{\ell+1}(\Omega)^d  \right) \cap H^3\left(0,T;\; H^1(\Omega)^d\right)$ and $p\in W^{2,\infty}\left(0,T;\; H^{\ell}(\Omega) \right)\cap H^3\left(0,T;\; L^2(\Omega)\right)$, then there exist $c_s>0$ and $h_s>0$ such that for $h\in (0,h_s]$ and $\tau \leq c_s /\left(1+|\log(h^{-1})| \right)^{1/2}$ in 2 dimensions or $\tau \leq c_s h^{1/2}$ in 3 dimensions we have
  \begin{equation}
    \left\| \left(\ub - \ut_h \right)_{\tau} \right\|_{\ell^{\infty}\left(H^1(\Omega)^d\right)} + \left\| \left(p - p_h \right)_{\tau} \right\|_{\ell^{\infty}\left(L^2(\Omega)\right)} \lesssim \tau + h^{\ell}
  \end{equation}
\end{theorem}

\begin{theorem}\label{thm:guermondthm3.3}
Under the regularity hypothesis of Theorem~\ref{thm:guermondthm3.1} and its restrictions on $\tau$ and $h$, the error bounds also hold
    \begin{equation}
      \left\| \left(\ub - \ub_h \right)_{\tau} \right\|_{\ell^{2}\left(L^2(\Omega)^d\right)} + \left\| \left(\ub - \ut_h \right)_{\tau} \right\|_{\ell^{2}\left(L^2(\Omega)^d\right)} \lesssim \tau^2 + h^{\ell+1}
    \end{equation}
\end{theorem}

If we want improved error bounds for $\ell^{\infty}\left( L^2(\Omega)^d \right)$ norm, we must add more regularity as follows:
\begin{theorem}\label{thm:guermondthm3.4}
If $\ub(t,x)\in W^{3,\infty}\left(0,T;\; H_0^1(\Omega)^d \cap H^{\ell+1}(\Omega)^d  \right) \cap H^4\left(0,T;\; H^1(\Omega)^d\right)$ and $p\in W^{2,\infty}\left(0,T;\; H^{\ell}(\Omega) \right)\cap H^4\left(0,T;\; L^2(\Omega)\right)$, with the restrictions on $\tau$ and $h$ of Theorem~\ref{thm:guermondthm3.1}, then
  \begin{equation}
    \left\| \left(\ub - \ub_h \right)_{\tau} \right\|_{\ell^{\infty}\left(L^2(\Omega)^d\right)} + \left\| \left(\ub - \ut_h \right)_{\tau} \right\|_{\ell^{\infty}\left(L^2(\Omega)^d\right)} \lesssim \tau^{7/4} + \tau^{3/4}h^{\ell} + h^{\ell+1}
  \end{equation}
\end{theorem}

The estimates on the pressure norm of Theorem~\ref{thm:guermondthm3.2} can be improved by introducing a discrete norm as follows.  Let $(v_h,q_h) \in X_h\times M_h$ and define $B_h \in \mathcal{L}(X_h,M_h)$ be the discrete divergence operator $(B_h v_h, q_h) = (v_h, B_h^T q_h) = -(\nabla\cdot v_h, q_h)$.  Then define the discrete norm for $v_h \in X_h$ as $\|v_h\|_{\mathcal{A}_h} = \sup_{w_h \in X_h} (\nabla v_h, \nabla w_h)/ \|w_h\|_{L^2(\Omega)}$ and for $q\in L^2(\Omega)$, let $\|q\|_{B_h, \mathcal{A}_h} = \sup_{v_h\in X_h} (q, \nabla\cdot v_h)/ \|v_h\|_{\mathcal{A}_h}$.

\begin{theorem}\label{thm:guermondthm3.5}
Under the regularity hypothesis of Theorem~\ref{thm:guermondthm3.4} and its restrictions on $\tau$ and $h$, the error bounds also hold
    \begin{equation}
      \left\| \left(p - p_h \right)_{\tau} \right\|_{\ell^{2}\left(\|\cdot\|_{B_h, \mathcal{A}_h}\right)} \lesssim \tau^{3/2} + h^{\ell}
    \end{equation}
\end{theorem}



\section{Constant Density Incompressible Navier Stokes in Rotational Form Convergence Theorems}

\begin{theorem}
Given that the true solution is smooth enough, the numerical solution, $(\ub^k, \ut^k, p^k)$, of the constant density incompressible Navier-Stokes algorithm using the second order approximation in time, pressure correction scheme in rotational form gives the following convergence estimates:
\begin{align*}
\left\| \left(\ub - \ub_h\right)_{\tau} \right\|_{\ell^2\left([L^2(\Omega)]^d \right)} + \left\| \left(\ub - \ut_h\right)_{\tau} \right\|_{\ell^2\left([L^2(\Omega)]^d \right)} &\lesssim \tau^2\\
\left\| \left(\ub - \ub_h\right)_{\tau} \right\|_{\ell^2\left([H^1(\Omega)]^d \right)} + \left\| \left(\ub - \ut_h\right)_{\tau} \right\|_{\ell^2\left([H^1(\Omega)]^d \right)}  &\lesssim \tau^{3/2}\\
 \left\| \left(p - p_h\right)_{\tau} \right\|_{\ell^2\left([L^2(\Omega)]^d \right)} &\lesssim \tau^{3/2}
\end{align*}

\end{theorem}
\begin{proof}
See Theorem 4.1 of \cite{guermond2004error} for details
\end{proof}


\section{Variable Density Incompressible Navier Stokes in Standard Form Convergence Theorems}

\begin{theorem}\label{thm:vardensityStandardFormBDF1}
If $\rho \in W^{1,\infty}\left(0,T; \; W^{1,\infty}(\Omega) \right)$, $\ub \in W^{1,\infty}\left(0,T;\; H^1_0(\Omega)^d\cap H^{\ell+1}(\Omega^d) \right)$ and $p\in W^{1,\infty}\left( H^{\ell}(\Omega)\right)$ and there exist $\chi, \eta >0 $ such that for all $k$, $\chi \leq \min_{\x} \rho^k(\x)$ and $\sup_{\x} \rho^k(\x) \leq \eta$. Assume (to decouple the density from velocity) that we can construct a sequence $(\rho^k)_k$ from a sequence $(\ub^k)_k$ of velocities in such a way that
\begin{align}
  \|(\rho - &\rho^k)_{\tau}\|^2_{\ell^{\infty}(H^1)} + \left\| \left( \rho_t - \frac{\rho^k - \rho^{k-1}}{\tau} \right)_{\tau} \right\|^2_{\ell^{\infty}(L^2)}\\
  &\leq c(\lambda)(\tau + h^{\ell+1})^2 + \lambda \left\| \Pi_h\ub(t^k) - \ub^k  \right\|^2_{H^1} + c(\lambda)\left\|\sqrt{\rho^k} \left(\Pi_h\ub(t^k) - \ub^k\right)\right\|^2_{L^2}
  \end{align}
  where $\lambda>0$ can be chose as small as is needed. And finally, we assume that the initial approximation of data 
  \begin{equation}
    \|\rho(t^0) - \rho^0\|_{L^{\infty}} + \|\ub(t^0)-\ub^{0}\|_{L^2} + h\|\ub(t^0) - \ub^0\| + h\|p(t^0) - p^0\| \lesssim h^{\ell+1}
  \end{equation}
  holds.  Then the incremental BDF1 variable density algorithm has the following error estimates
  \begin{align}
    \left\|\left(\ub - \ub_h\right)_{\tau}\right\|_{\ell^{\infty}(L^2(\Omega)^d)} &\lesssim \tau + h^{\ell+1}\\
    \left\|\left(\ub - \ub_h\right)_{\tau}\right\|_{\ell^{2}(H^1(\Omega)^d)} &\lesssim \tau + h^{\ell}\\
    \left\|\left(p - p_h\right)_{\tau}\right\|_{\ell^{2}(L^2(\Omega))} & \lesssim \tau + h^{\ell}  \mbox{  (not stated or proven but should be true)}
  \end{align}
\end{theorem}
\begin{proof}
  See proof of Theorem 4.2 of \cite{guermond2011error}.
\end{proof}

\begin{conjecture}
  Under the assumptions of Theorem~\ref{thm:vardensityStandardFormBDF1}, the BDF2 standard form algorithm has the following error estimates:
  \begin{align}
    \left\| \left(\sqrt{\rho} \ub - \sqrt{\rho_h} \ub_h \right)_{\tau} \right\|_{\ell^{\infty}(L^2(\Omega)^d)} &\lesssim \tau^2 + h^{\ell+1}\\
    \left\| \left(\ub - \ub_h \right)_{\tau} \right\|_{\ell^2(H^1(\Omega)^d)} &\lesssim \tau + h^{\ell}\\
    \left\|\left(p - p_h\right)_{\tau} \right\|_{\ell^{2}(L^2(\Omega))} &\lesssim \tau + h^{\ell}  \mbox{  (not stated or proven but should be true)}
  \end{align}
\end{conjecture}


\section{Variable Density Incompressible Navier Stokes in Rotational Form Convergence Theorems}

\begin{conjecture}
  Under the assumptions of Theorem~\ref{thm:vardensityStandardFormBDF1}, the BDF2 rotational form algorithm has the following error estimates:
  \begin{align}
    \left\| \left(\sqrt{\rho} \ub - \sqrt{\rho_h} \ub_h \right)_{\tau} \right\|_{\ell^{\infty}(L^2(\Omega)^d)} &\lesssim \tau^2 + h^{\ell+1}\\
    \left\| \left( \ub - \ub_h \right)_{\tau} \right\|_{\ell^2(H^1(\Omega)^d)} &\lesssim \tau^{3/2} + h^{\ell}\\
    \left\|\left(p - p_h\right)_{\tau} \right\|_{\ell^{2}(L^2(\Omega))} &\lesssim \tau^{3/2} + h^{\ell}  \mbox{  (not stated or proven but should be true)}
  \end{align}
\end{conjecture}

\appendix
%
%
%
%
\chapter{Various Extensions and Proofs}

%
%
%
\section{Rotational Scheme Still Consistent with Variable Viscosity but Constant Density}
We verify that the artificial boundary conditions imposed on pressure by the rotational fix under assumptions of constant viscosity and density still roughly hold when viscosity is no longer constant.  Mainly we will show that 
\begin{equation}
  \left.\frac{\partial p^{k+1}}{\partial \n}\right|_{\partial\Omega} = \left.\left(f^{k+1} + \nabla\cdot\ut^{k+1}\nabla\mu - \nabla\times\left(\mu\nabla\times \ub^{k+1}  \right)  \right)\cdot \n\right|_{\partial\Omega}
\end{equation}
which is almost a consistent pressure boundary condition.  Compare this to the imposed boundary condition when viscosity is assumed constant
\begin{equation}
  \left.\frac{\partial p^{k+1}}{\partial \n}\right|_{\partial\Omega} = \left.\left(f^{k+1} - \mu\nabla\times\nabla\times \ub^{k+1} \right)\cdot \n\right|_{\partial\Omega}
\end{equation}
 as discussed in \cite{guermond2004error}.  
 
 Thus we are left with the distortions from the operator splitting being manifest as the tangential velocity requirement
\begin{equation}
  \left.\ub^{k+1}\cdot\n\right|_{\partial\Omega} = 0.
\end{equation}
and an extra penalty term manifesting in the normal pressure gradient scaled by $\nabla\cdot\ut^{k+1}$.  



%
%
\subsection{Proof of consistent boundary conditions}
The following identities on a smooth vector function $\Ab$ will be of use to us:
\begin{align}
  \nabla\times\nabla\times \Ab &= \nabla\left( \nabla\cdot \Ab\right) - \nabla^2 \Ab\label{eqn:curlcurlidentity}\\
  \nabla\times\left( \mu \nabla\times \Ab \right) &= \mu\nabla\left(\nabla\cdot \Ab\right) - \nabla\cdot\left(\mu \nabla \Ab \right)\label{eqn:curlmucurlidentity}\\
  \nabla\left( \mu \nabla\cdot \Ab\right) &= \mu\nabla\left(\nabla\cdot \Ab\right) + \left( \nabla\cdot \Ab\right)\nabla\mu\label{eqn:gradmudividentity}
\end{align}

Recall that we are approximating the solution to the continuous equations
\begin{numcases}{}
  \rho\left(\frac{\partial \ub}{\partial t}  + \ub\cdot\nabla\ub\right) - \nabla\left(\cdot\mu \nabla\ub\right) + \nabla p = \fb\label{eqn:continuousmomentumequation}\\
  \left.\ub\right|_{\partial\Omega} = 0\label{eqn:continuousvelocitydirichletbc}\\
  \nabla\cdot\ub = 0\label{eqn:continuousdivergencevelocityequalszero}
\end{numcases}
with constant density and variable viscosity.  To proceed with the proof, we start with the initial scheme (any BDF formula for time derivative will work but we give proof in terms of BDF1)
\begin{numcases}{}
  \frac{\rho}{\tau}\left( \ut^{k+1} - \ub^{k}\right) + \rho \ut^{k}\cdot\nabla\ut^{k+1} - \nabla\cdot\left(\mu\nabla\ut^{k+1}\right) + \nabla p^{k} = \fb^{k+1},\label{eqn:initialmomentum}\\ 
  \left.\ut^{k+1}\right|_{\partial\Omega} = 0,\\
  \frac{\rho}{\tau}\left(\ub^{k+1} - \ut^{k+1}  \right) + \nabla \phi^{k+1} = 0,\label{eqn:initialprojection} \\
  \left.\ub^{k+1}\cdot\n\right|_{\partial\Omega} = 0,\\
  \nabla\cdot \ub^{k+1} = 0,\\
  p^{k+1} = p^{k} + \phi^{k+1} - \mu\nabla\cdot\ut^{k+1}.\label{eqn:initialpressureupdate}
\end{numcases}
By applying $\nabla\times\left(\mu\nabla\times \ \cdot\  \right)$ to both sides of (\ref{eqn:initialprojection}) we observe that
\begin{equation}\label{eqn:curlcurluequalscurlcurlutilde}
  \nabla\times\left( \mu\nabla\times \ub^{k+1}\right) =   \nabla\times\left( \mu\nabla\times \ut^{k+1}\right)
\end{equation}

So by plugging equations (\ref{eqn:initialprojection}) and (\ref{eqn:initialpressureupdate}) into (\ref{eqn:initialmomentum}) and using identities (\ref{eqn:curlmucurlidentity}) and (\ref{eqn:gradmudividentity}) (with $\Ab=\ut^{k+1}$) and applying (\ref{eqn:curlcurluequalscurlcurlutilde}), we obtain

\begin{numcases}{}
  \begin{split}\frac{\rho}{\tau}\left(\ub^{k+1} - \ub^{k}   \right) + \rho\ut^{k}\cdot\nabla\ut^{k+1} + \nabla\times\left( \mu\nabla\times\ub^{k+1}\right)&\\ 
    - \left(\nabla\cdot\ut^{k+1}\right)\nabla\mu + \nabla p^{k+1} &= \fb^{k+1},\end{split}\label{eqn:momentumcwithurlculequation}\\
  \left.\ut^{k+1}\right|_{\partial\Omega} = 0,\label{eqn:utildeonboundaryequalszero}\\
  \left.\ub^{k+1}\cdot\n\right|_{\partial\Omega} = 0,\label{eqn:tangentialuonboundaryequalszero}\\
  \nabla\cdot\ub^{k+1} = 0.\label{eqn:divuequalszero}
\end{numcases}
By dotting (\ref{eqn:momentumcwithurlculequation}) with $\n$ and restricting to boundary and using properties (\ref{eqn:utildeonboundaryequalszero}) and (\ref{eqn:tangentialuonboundaryequalszero}), we get the normal pressure gradient condition

\begin{equation}
  \left.\frac{\partial p^{k+1}}{\partial \n}\right|_{\partial\Omega} = \left.\left(f^{k+1} + \nabla\cdot\ut^{k+1}\nabla\mu - \nabla\times\left(\mu\nabla\times \ub^{k+1}  \right)  \right)\cdot \n\right|_{\partial\Omega}.
\end{equation}

Finally notice that because of (\ref{eqn:divuequalszero}) and (\ref{eqn:curlmucurlidentity}), we have 
\begin{equation}
  \nabla\times\left(\mu\nabla\times \ub^{k+1}\right) = \nabla\cdot\left(\mu\nabla\ub^{k+1}\right)
\end{equation}
so 
\begin{equation}
  \left.\frac{\partial p^{k+1}}{\partial \n}\right|_{\partial\Omega} = \left.\left(f^{k+1} + \nabla\cdot\left(\mu\nabla\ub^{k+1}\right) \right)\cdot \n\right|_{\partial\Omega} + \left.\nabla\cdot\ut^{k+1}\frac{\partial\mu}{\partial\n}\right|_{\partial\Omega},
\end{equation}
which is almost consistent with the momentum equation (\ref{eqn:continuousmomentumequation}).  The inconsistency comes from the $\nabla\cdot\ut^{k+1}\frac{\partial\mu}{\partial\n}$ term which can be seen as a penalty term for the normal pressure gradient.

%
%
\subsection{Note, if we use $-\nabla\cdot(\mu\ut^{k+1})$ instead of $-\mu\nabla\cdot\ut^{k+1}$ in pressure update}
In this case, we must use the identities
\begin{equation}
    \nabla\left( \nabla\cdot\left( \mu \Ab\right) \right) = \nabla\left(\mu\nabla\cdot\Ab\right) + \nabla\left( \nabla\mu\cdot\Ab \right)
\end{equation}
and 
\begin{equation}
  \nabla\left(\Ab\cdot \Bb\right) = \left( \Ab\cdot\nabla\right)\Bb + \left( \Bb\cdot\nabla\right)\Ab + \Ab\times\left(\nabla\times\Bb\right) + \Bb\times\left(\nabla\times\Ab\right)
\end{equation}
  where $\Bb = \nabla\mu$ and $\Ab = \ut^{k+1}$ to get the extra terms of inconsistency.  We end up with the following boundary conditions
\begin{equation}
  \begin{split}\left.\frac{\partial p^{k+1}}{\partial \n}\right|_{\partial\Omega} = &\left.\left(f^{k+1} + \nabla\cdot\left(\mu\nabla\ub^{k+1}\right) \right)\cdot \n\right|_{\partial\Omega}\\ &+ \left.\left(\nabla\cdot\ut^{k+1}\nabla\mu  + \nabla\mu\cdot\nabla\ut^{k+1} + \nabla\mu\times\left( \nabla\times\ut^{k+1}\right) \right)\cdot\n\right|_{\partial\Omega}. \end{split}
\end{equation}



\bibliographystyle{chicago}
\bibliography{ps.bib}
% \appendix
%\input{GWVD_COETR_Consistent_Velocity_Appendix}
%\input{GWVD_COETR_Velocity_Postprocessing_Appendix}
%input{GWVD_COETR_variational_multiscale_appendix}

\end{document}
